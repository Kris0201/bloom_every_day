import{b as P}from"./bootstrap.bundle.min-d195b181.js";import{s as F}from"./setAuthFactory-2f9bf77f.js";import{P as V}from"./PaginationComponent-6bc0074a.js";import{S as b}from"./sweetalert2.all-74d5efc1.js";import{_ as D,r as x,o as n,c as d,e as U,d as t,F as g,y as w,C as a,I as r,f,O as v,N as I,t as p,p as L,g as N}from"./index-79cbc443.js";const{VITE_URL:_,VITE_PATH:h}={VITE_URL:"https://vue3-course-api.hexschool.io/",VITE_PATH:"bloom-api",BASE_URL:"/bloom_every_day/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},S={data(){return{products:[],tempProduct:{imagesUrl:[]},isLoading:!1,fullPage:!0,isNew:!0,status:{fileUploading:!1},page:{}}},components:{Pagination:V},methods:{getProducts(i=1){this.isLoading=!0,this.$http.get(`${_}v2/api/${h}/admin/products/?page=${i}`).then(e=>{this.products=e.data.products,this.page=e.data.pagination,this.isLoading=!1}).catch(e=>{console.log(e)})},uploadFile(){const i=this.$refs.fileInput.files[0],e=new FormData;e.append("file-to-upload",i),this.status.fileUploading=!0,this.$http.post(`${_}v2/api/${h}/admin/upload`,e,{headers:{"Content-Type":"multipart/form-data"}}).then(u=>{this.status.fileUploading=!1,u.data.success&&(this.tempProduct.imageUrl=u.data.imageUrl,this.$refs.fileInput.value="",b.fire({toast:!0,position:"top",showConfirmButton:!1,timer:2e3,title:'<h6 class="mb-0" style="color:#FF3D33; text-align:center;">成功上傳圖片！</h6>'}))}).catch(()=>{this.status.fileUploading=!1,b.fire({toast:!0,position:"top",showConfirmButton:!1,timer:2e3,title:'<h6 class="mb-0" style="background:#FF3D33; color:white; text-align:center;">圖片上傳失敗！</h6>'})})},openModal(i,e){i==="create"?(this.productModal.show(),this.isNew=!0,this.tempProduct={imagesUrl:[]}):i==="edit"?(this.productModal.show(),this.isNew=!1,this.tempProduct={...e}):(this.delModal.show(),this.isNew=!1,this.tempProduct={...e})},confirmUpdate(i){let e=`${_}v2/api/${h}/admin/product`,u="post";this.isNew||(e=`${_}v2/api/${h}/admin/product/${i.id}`,u="put"),this.$http[u](e,{data:i}).then(()=>{b.fire({toast:!0,position:"top",showConfirmButton:!1,timer:2e3,title:this.isNew?'<h6 class="mb-0" style="color:#FF3D33; text-align:center;">已新增商品！</h6>':'<h6 class="mb-0" style="color:#FF3D33; text-align:center;">已更新商品！</h6>'}),this.productModal.hide(),this.getProducts()}).catch(y=>{console.log(y)})},deleteProduct(i){this.$http.delete(`${_}v2/api/${h}/admin/product/${i}`).then(()=>{b.fire({toast:!0,position:"top",showConfirmButton:!1,timer:2e3,title:'<h6 class="mb-0" style="color:#FF3D33; text-align:center;">已刪除商品！</h6>'}),this.delModal.hide(),this.getProducts()}).catch(e=>{console.log(e)})}},mounted(){F(this.$http,this.$router),this.productModal=new P.Modal(this.$refs.productModal),this.delModal=new P.Modal(this.$refs.deleteModal),this.getProducts()}},l=i=>(L("data-v-b47c9add"),i=i(),N(),i),T={class:"product container"},A=l(()=>t("h5",{class:"admin_title_h5"},"商品管理頁面",-1)),B={class:"text-end my-4"},E={class:"row mx-auto"},R={class:"col-sm-12 p-0"},O={class:"table product_table"},H=l(()=>t("tr",null,[t("th",{class:"col-2"},"分類"),t("th",{class:"col-2"},"產品名稱"),t("th",{class:"col-2"},"原價"),t("th",{class:"col-2"},"售價"),t("th",{class:"col-2"},"是否啟用"),t("th",{class:"col-2"},"編輯")],-1)),j={"data-th":"分類"},q={"data-th":"產品名稱"},z={"data-th":"原價"},G={"data-th":"售價"},J={"data-th":"是否啟用"},K={key:0},Q={key:1},W={class:"btn_td","data-th":"編輯"},X=["onClick"],Y=["onClick"],Z={class:"modal fade",id:"productModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"productModal"},$={class:"modal-dialog modal-xl",role:"document"},tt={class:"modal-content border-0"},et={class:"modal-header bg-bg-2 text-dark-text"},ot={class:"modal-title",id:"exampleModalLabel"},st={key:0},lt={key:1},it=l(()=>t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1)),nt={class:"modal-body"},dt={class:"row"},at={class:"col-sm-4"},rt={class:"mb-3"},ct=l(()=>t("label",{for:"image",class:"form-label"},"輸入圖片網址",-1)),ut={class:"mb-3"},mt={for:"customFile",class:"form-label"},pt={key:0,class:"bi bi-cloud-arrow-up"},_t=["src"],ht={key:0,class:"mt-5"},bt=["onUpdate:modelValue"],ft=["src"],gt={style:{"margin-bottom":"20px"}},vt={class:"col-sm-8"},yt={class:"mb-3"},Pt=l(()=>t("label",{for:"title",class:"form-label"},"標題",-1)),xt={class:"row gx-2"},Ut={class:"mb-3 col-md-6"},wt=l(()=>t("label",{for:"category",class:"form-label"},"分類",-1)),kt={class:"mb-3 col-md-6"},Mt=l(()=>t("label",{for:"price",class:"form-label"},"單位",-1)),Ct={class:"row gx-2"},Ft={class:"mb-3 col-md-6"},Vt=l(()=>t("label",{for:"origin_price",class:"form-label"},"原價",-1)),Dt={class:"mb-3 col-md-6"},It=l(()=>t("label",{for:"price",class:"form-label"},"售價",-1)),Lt=l(()=>t("hr",null,null,-1)),Nt={class:"mb-3"},St=l(()=>t("label",{for:"description",class:"form-label"},"商品描述",-1)),Tt={class:"mb-3"},At=l(()=>t("label",{for:"content",class:"form-label"},"說明內容",-1)),Bt={class:"mb-3"},Et={class:"form-check"},Rt=l(()=>t("label",{class:"form-check-label",for:"is_enabled"}," 是否啟用 ",-1)),Ot={class:"modal-footer"},Ht=l(()=>t("button",{type:"button",class:"btn btn_cancel btn-outline-neutral","data-bs-dismiss":"modal"}," 取消 ",-1)),jt={class:"modal fade",id:"delModal",tabindex:"-1",role:"dialog","aria-labelledby":"exampleModalLabel","aria-hidden":"true",ref:"deleteModal"},qt={class:"modal-dialog",role:"document"},zt={class:"modal-content border-0"},Gt=l(()=>t("div",{class:"modal-header bg-primary text-white"},[t("h5",{class:"modal-title"},[t("span",null,"刪除")]),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1)),Jt={class:"modal-body"},Kt={class:"text-primary"},Qt=l(()=>t("strong",{class:"text-danger"},null,-1)),Wt={class:"modal-footer"},Xt=l(()=>t("button",{type:"button",class:"btn btn_cancel btn-outline-neutral","data-bs-dismiss":"modal"}," 取消 ",-1));function Yt(i,e,u,y,o,c){const k=x("vue-loading"),M=x("Pagination");return n(),d(g,null,[U(k,{active:o.isLoading,"onUpdate:active":e[0]||(e[0]=s=>o.isLoading=s),"is-full-page":o.fullPage,opacity:1},null,8,["active","is-full-page"]),t("div",T,[A,t("div",B,[t("button",{class:"btn btn-primary text-white add_btn",onClick:e[1]||(e[1]=s=>c.openModal("create"))}," 新增商品 ")]),t("div",E,[t("div",R,[t("table",O,[H,(n(!0),d(g,null,w(o.products,s=>(n(),d("tr",{key:s.id},[t("td",j,p(s.category),1),t("td",q,p(s.title),1),t("td",z,p(s.origin_price),1),t("td",G,p(s.price),1),t("td",J,[s.is_enabled===1?(n(),d("span",K,"已啟用")):(n(),d("span",Q,"未啟用"))]),t("td",W,[t("div",null,[t("button",{class:"btn btn_edit btn-outline-neutral me-3",type:"button",onClick:m=>c.openModal("edit",s)}," 編輯 ",8,X),t("button",{class:"btn btn_delete btn-outline-primary",type:"button",onClick:m=>c.openModal("delete",s)}," 刪除 ",8,Y)])])]))),128))])])]),U(M,{pages:o.page,onChangePage:c.getProducts},null,8,["pages","onChangePage"]),t("div",Z,[t("div",$,[t("div",tt,[t("div",et,[t("h5",ot,[o.isNew?(n(),d("span",st,"新增商品")):(n(),d("span",lt,"編輯商品"))]),it]),t("div",nt,[t("div",dt,[t("div",at,[t("div",rt,[ct,a(t("input",{type:"text",class:"form-control",id:"image",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[2]||(e[2]=s=>o.tempProduct.imageUrl=s)},null,512),[[r,o.tempProduct.imageUrl]])]),t("div",ut,[t("label",mt,[f("或 上傳圖片 "),o.status.fileUploading?(n(),d("i",pt)):v("",!0)]),t("input",{type:"file",id:"customFile",class:"form-control",ref:"fileInput",onChange:e[3]||(e[3]=(...s)=>c.uploadFile&&c.uploadFile(...s))},null,544)]),t("img",{class:"img-fluid",src:o.tempProduct.imageUrl},null,8,_t),Array.isArray(o.tempProduct.imagesUrl)?(n(),d("div",ht,[(n(!0),d(g,null,w(o.tempProduct.imagesUrl,(s,m)=>(n(),d("div",{class:"mb-3",key:m+133},[a(t("input",{type:"url",class:"form-control form-control",placeholder:"請輸入連結","onUpdate:modelValue":C=>o.tempProduct.imagesUrl[m]=C},null,8,bt),[[r,o.tempProduct.imagesUrl[m]]]),t("div",null,[t("img",{class:"img-fluid",src:o.tempProduct.imagesUrl[m]},null,8,ft)])]))),128)),t("div",gt,[!o.tempProduct.imagesUrl.length||o.tempProduct.imagesUrl[o.tempProduct.imagesUrl.length-1]?(n(),d("button",{key:0,class:"btn btn-outline-primary btn-sm d-block w-100 add_img_btn",onClick:e[4]||(e[4]=s=>o.tempProduct.imagesUrl.push(""))}," 新增圖片 ")):v("",!0),t("button",{type:"button",class:"my-2 btn btn-sm d-block w-100 btn-outline-neutral remove_img_btn",onClick:e[5]||(e[5]=s=>o.tempProduct.imagesUrl.pop(""))}," 移除 ")])])):v("",!0)]),t("div",vt,[t("div",yt,[Pt,a(t("input",{type:"text",class:"form-control",id:"title",placeholder:"請輸入標題","onUpdate:modelValue":e[6]||(e[6]=s=>o.tempProduct.title=s)},null,512),[[r,o.tempProduct.title]])]),t("div",xt,[t("div",Ut,[wt,a(t("input",{type:"text",class:"form-control",id:"category",placeholder:"請輸入分類","onUpdate:modelValue":e[7]||(e[7]=s=>o.tempProduct.category=s)},null,512),[[r,o.tempProduct.category]])]),t("div",kt,[Mt,a(t("input",{type:"text",class:"form-control",id:"unit",placeholder:"請輸入單位","onUpdate:modelValue":e[8]||(e[8]=s=>o.tempProduct.unit=s)},null,512),[[r,o.tempProduct.unit]])])]),t("div",Ct,[t("div",Ft,[Vt,a(t("input",{type:"number",class:"form-control",id:"origin_price",min:"0",placeholder:"請輸入原價","onUpdate:modelValue":e[9]||(e[9]=s=>o.tempProduct.origin_price=s)},null,512),[[r,o.tempProduct.origin_price,void 0,{number:!0}]])]),t("div",Dt,[It,a(t("input",{type:"number",class:"form-control",id:"price",min:"0",placeholder:"請輸入售價","onUpdate:modelValue":e[10]||(e[10]=s=>o.tempProduct.price=s)},null,512),[[r,o.tempProduct.price,void 0,{number:!0}]])])]),Lt,t("div",Nt,[St,a(t("textarea",{type:"text",class:"form-control",id:"description",placeholder:"請輸入商品描述","onUpdate:modelValue":e[11]||(e[11]=s=>o.tempProduct.content=s)},null,512),[[r,o.tempProduct.content]])]),t("div",Tt,[At,a(t("textarea",{type:"text",class:"form-control",id:"content",placeholder:"請輸入商品說明內容","onUpdate:modelValue":e[12]||(e[12]=s=>o.tempProduct.description=s)},null,512),[[r,o.tempProduct.description]])]),t("div",Bt,[t("div",Et,[a(t("input",{class:"form-check-input",type:"checkbox","true-value":1,"false-value":0,id:"is_enabled","onUpdate:modelValue":e[13]||(e[13]=s=>o.tempProduct.is_enabled=s)},null,512),[[I,o.tempProduct.is_enabled]]),Rt])])])])]),t("div",Ot,[Ht,t("button",{type:"button",class:"btn btn_confirm btn-outline-primary",onClick:e[14]||(e[14]=s=>c.confirmUpdate(o.tempProduct))}," 確認 ")])])])],512),t("div",jt,[t("div",qt,[t("div",zt,[Gt,t("div",Jt,[f(" 是否刪除 "),t("span",Kt,[t("b",null,p(o.tempProduct.title),1)]),f(" 這項商品？"),Qt,f(" (刪除後將無法恢復)。 ")]),t("div",Wt,[Xt,t("button",{type:"button",class:"btn btn-danger",onClick:e[15]||(e[15]=s=>c.deleteProduct(o.tempProduct.id))}," 確認刪除 ")])])])],512)])],64)}const se=D(S,[["render",Yt],["__scopeId","data-v-b47c9add"]]);export{se as default};
